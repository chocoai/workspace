<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.whty.assis.demo.dao.ActivityCountDao">


	<resultMap type="com.whty.assis.demo.model.AreaMonthActivityCount" id="AreaMonthActivityCountResult">		
		<result property="orgId" column="org_id" />
		<result property="orgName" column="org_name" />
		<result property="createTime" column="create_time" />
		<result property="areaCode" column="area_code" />
		<result property="areaName" column="area_name" />
		<result property="useActivity" column="use_activity" />
		<result property="previousUseActivity" column="previous_use_activity" />		
		<result property="rate" column="rate" />
		<result property="updateTime" column="update_time" />
		<result property="year" column="year" />
		<result property="month" column="month" />
		<result property="platformCode" column="platform_code" />
		<result property="platformName" column="platform_name"/>
	</resultMap>

	<resultMap type="com.whty.assis.demo.model.OrgMonthActivityCount" id="OrgMonthActivityCountResult">		
		<result property="orgId" column="org_id" />
		<result property="userId" column="user_id" />
		<result property="userName" column="user_name" />
		<result property="orgName" column="org_name" />
		<result property="createTime" column="create_time" />
		<result property="areaCode" column="area_code" />
		<result property="areaName" column="area_name" />
		<result property="rate" column="rate" />
		<result property="previousUseActivity" column="previous_use_activity" />
		<result property="useActivity" column="use_activity" />
		<result property="updateTime" column="update_time" />
		<result property="year" column="year" />
		<result property="month" column="month" />
		<result property="platformCode" column="platform_code" />
		<result property="platformName" column="platform_name"/>
	</resultMap>
	
	<select id="getOrgMonthActivityCount" parameterType="map" resultMap="OrgMonthActivityCountResult">
	select t3.platform_name,t1.platform_code,t1.user_id,t1.user_name,t1.org_id,t1.org_name,t1.use_activity,T1.YEAR,t1.month,t1.create_time,t1.update_time,t1.rate,t1.previous_use_activity,t1.area_code,t2.area_name
            from TA_ORG_MONTH_ACTIVITY_COUNT t1 left join ta_area t2 on t1.area_code = t2.area_code left join TA_BASE_PROPERTY t3 on t1.platform_code = t3.platform_code and t3.property_key='platform_url'
    where 1=1
			<if test="orgId != null and orgId != ''">and t1.org_id=#{orgId}</if>
			<if test="userId != null and userId != ''">and t1.user_id=#{userId}</if>
			<if test="year != null ">and t1.year = #{year}</if>
			<if test="month != null">and t1.month = #{month}</if>
			<if test="platformCode != null and orgId != ''">and t1.platform_code = #{platformCode}</if>
			<if test="areaid != null and areaid != ''">and t1.area_code like #{areaid}||'%'</if>
	</select>
	
	
	<select id="getAreaMonthActivityCount" parameterType="map" resultMap="AreaMonthActivityCountResult">
		select t3.platform_name,t1.platform_code,t1.org_id,t1.org_name,t1.use_activity,T1.YEAR,t1.month,t1.create_time,t1.update_time,t1.rate,t1.previous_use_activity,t1.area_code,t2.area_name
			from TA_AREA_MONTH_ACTIVITY_COUNT t1 left join ta_area t2 on t1.area_code = t2.area_code left join TA_BASE_PROPERTY t3 on t1.platform_code = t3.platform_code and t3.property_key='platform_url'
		where 1=1
			<if test="orgId != null and orgId != ''">and t1.org_id=#{orgId}</if>
			<if test="year != null ">and t1.year = #{year}</if>
			<if test="month != null">and t1.month = #{month}</if>
			<if test="platformCode != null">and t1.platform_code = #{platformCode}</if>
			<if test="areaid != null and areaid != ''">and t1.area_code like #{areaid}||'%'</if>
			<if test="orgName != null and orgName != ''">and t1.org_name like '%'||#{orgName}||'%'</if>
	</select>
	
	
</mapper>
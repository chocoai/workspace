<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.whty.wfd.page.dao.LikeMapper">
  <resultMap id="BaseResultMap" type="com.whty.wfd.page.vo.Like">
    <result column="plate_post_id"  property="id" />
    <result column="type"  property="type" />
    <result column="user_id"  property="userId" />
    <result column="is_read"  property="isRead" />
    <result column="create_time"  property="createTime" />
    <result column="update_time" property="updateTime" />
    <result column="creatorName" property="creatorName" />
    <result column="postContent" property="postContent" />
    <result column="replyContent" property="replyContent" />
    <result column="replyPostContent" property="replyPostContent" />
    <result column="replyPostId" property="replyPostId" />
    <result column="logo_url" property="logoUrl" />
  </resultMap>

  <select id="getLikes" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select hbb.*,tu2.name creatorName,tpp.content postContent,tpm.content replyContent,
    tpp2.content replyPostContent,tpp2.id replyPostId,tu2.logo_url logo_url from
    (select *,1 type from t_post_like tpl
    union ALL
    select *,2 type from t_post_message_like tpml
    )hbb
		left join t_user tu2 on tu2.id=hbb.user_id
    left join t_plate_post tpp on hbb.type=1 and tpp .id = hbb.plate_post_id  and tpp.is_delete=0
    left join t_post_message tpm on hbb.type=2 and  hbb.plate_post_id = tpm.id
    left join t_plate_post tpp2 on hbb.type=2 and tpp2.id = tpm.plate_post_id and tpp2.is_delete=0
    where tpp.creator =#{userId} or tpm.user_id =#{userId}
    ORDER BY hbb.create_time desc
  </select>



</mapper>
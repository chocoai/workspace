<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.whty.mxbj.api.dao.ArchiveNoteDao">
	
	<resultMap type="com.whty.mxbj.api.model.ArchiveNote" id="ArchiveNoteResult">
		<result column="archive_note_id" property="archiveNoteId" />
		<result column="note_id" property="noteId" />
		<result column="note_name" property="noteName" />
		<result column="create_time" property="createTime" />
		<result column="update_time" property="updateTime" />
		<result column="last_edit_time" property="lastEditTime" />
		<result column="start_time" property="startTime" />
		<result column="end_time" property="endTime" />
		<!-- <result column="pages" property="pages" />
		<result column="start_page_id" property="startPageId" /> -->
		<result column="user_id" property="userId" />
		<result column="user_platform_code" property="userPlatformCode" />
		<result column="subject_id" property="subjectName" />
		<result column="subject_name" property="subjectName" />
		<result column="archive_time" property="archiveTime" />
		<result column="platform_name" property="platformName"/>
		<result column="user_name" property="userName"/>
		<result column="account" property="account"/>
		<result column="account_type" property="accountType"/>
		<result column="phone_number" property="phoneNumber"/>
		<result column="cover_image_url" property="coverImageUrl"/>
		<result column="reader_image_url" property="readerImageUrl"/>
	</resultMap>
	
	
	<insert id="save" parameterType="com.whty.mxbj.api.model.ArchiveNote" >
		insert into T_ARCHIVE_NOTE (
		ARCHIVE_NOTE_ID
		,NOTE_ID
		,USER_ID
		,USER_PLATFORM_CODE
		<if test="noteName != null and noteName != ''">,note_name</if>
		<if test="lastEditTime != null ">,last_edit_time</if>
		<if test="createTime != null ">,create_time</if>
		<if test="startTime != null  ">,start_Time</if>
		<if test="endTime != null ">,end_Time</if>
		<if test="subjectId != null ">,subject_id</if>
		<if test="archiveTime != null ">,archive_time</if>
		) values(
		#{archiveNoteId}
		,#{noteId}
		,#{userId}
		,#{userPlatformCode}
		<if test="noteName != null and noteName != ''">,#{noteName}</if>
		<if test="lastEditTime != null ">,#{lastEditTime}</if>
		<if test="createTime != null ">,#{createTime}</if>
		<if test="startTime != null  ">,#{startTime}</if>
		<if test="endTime != null ">,#{endTime}</if>
		<if test="subjectId != null ">,#{subjectId}</if>
		<if test="archiveTime != null ">,#{archiveTime}</if>
		)
	</insert>

	<update id="updateArchiveTime" parameterType="com.whty.mxbj.api.model.ArchiveNote">
		update T_ARCHIVE_NOTE set archive_time =#{archiveTime} where archive_note_id=#{archiveNoteId}
	</update>

	<delete id="deleteById" parameterType="string">
		delete from T_ARCHIVE_NOTE WHERE archive_note_id = #{_parameter}
	</delete>
	
	<select id="loadById" parameterType="string" resultMap="ArchiveNoteResult">
		select * from T_ARCHIVE_NOTE where archive_note_id = #{_parameter}
	</select>

	<select id="listByCondition" parameterType="map" resultMap="ArchiveNoteResult">
select t5.COVER_IMAGE_URL,t5.READER_IMAGE_URL,t1.*,t2.user_name,t2.account,t2.account_type,t2.phone_number,t4.subject_id,
(select platform_name from T_BASE_PROPERTY  where platform_code=t1.user_platform_code and property_key = 'aam_url') AS platform_name
 from T_ARCHIVE_NOTE t1 left join T_USER t2 on 
 t1.user_id = t2.user_id and t1.user_platform_code= t2.user_platform_code 
 left join T_SUBJECT t4 on t1.subject_id= t4.subject_id left join T_NOTE_TEMPLATE t5 on t1.note_id=t5.note_id where 1=1
 	<if test="userId != null and userId != '' "> and t1.user_id=#{userId}</if>
 	<if test="noteId != null and noteId != '' "> and t1.note_Id=#{noteId}</if>
 	<if test="userPlatformCode != null and userPlatformCode != '' "> and t1.user_platform_code=#{userPlatformCode}</if>
 	 <if test="noteName != null and noteName != '' "> and t1.note_name like CONCAT('%',#{noteName},'%') </if>
	<if test="account != null and account != '' "> and (t2.account=#{account} or t2.phone_number = #{account})</if>
	order by t1.create_time desc
	</select>
	

</mapper>
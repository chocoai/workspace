<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.whty.assis.basicdata.dao.OrderTerminalDeviceTypeDao">

	<!-- 这里的Demo是别名，需要在mybatis-config.xml中定义，或者写类全名 -->
	<resultMap type="com.whty.assis.basicdata.model.OrderTerminalDeviceType" id="OrderTerminalDeviceTypeResult">
		<id property="id" column="id" />

		<result property="terminalDeviceTypeId"     column="terminal_device_type_id" />
		
		<result property="createTime" column="create_time" />
		
		<result property="updateTime" column="update_time" />
		
		<result property="quan" column="quan" />
		
		<result property="orderId" column="order_id" />
		
		<result property="aliProductKey" column="ali_product_key" />
		
		<result property="terminalDeviceName" column="terminal_device_name" />
	
	</resultMap>
	
	
	<delete id="deleteByOrder" parameterType="int">
		delete  from t_order_terminal_device_type where order_id=#{_parameter}
	</delete>
	
	<update id="update" parameterType="com.whty.assis.basicdata.model.OrderSchoolTerminalDevice">
		update t_order_terminal_device_type
		set 
		<trim prefixOverrides=",">
			<if test="quan != null   ">, quan=#{quan}</if>
			<if test="updateTime != null ">, update_time=#{updateTime}</if>
		</trim>
		where id=#{id}
	</update>
	
	<insert id="save" parameterType="com.whty.assis.basicdata.model.OrderSchoolTerminalDevice">
		insert into t_order_terminal_device_type (
			id
			,order_id
			,terminal_device_type_id
			,quan
			,create_time
			,update_time
		) values (
			#{id}
			,#{orderId}
			,#{terminalDeviceTypeId}
			,#{quan}
			,#{createTime}
			,#{updateTime}
		)
	</insert>
	
	<select id="getTotalQuanByOrderAndType" resultType="int" parameterType="map">
		select sum(quan) as quan from t_order_terminal_device_type where order_id=#{orderId} and terminal_device_type_id=#{terminalDeviceTypeId}
	</select>
	
		<select id="listByConditionByOrderId" parameterType="int" resultType="map">
		select t1.name,t1.id,t2.quan,t2.id as t_order_terminal_device_type_id from t_terminal_device_type t1 left join
		 (select * from t_order_terminal_device_type where order_id=#{_parameter}) t2 on t1.id = t2.terminal_device_type_id
		 group by t1.id
	</select>
	
	
	<select id="loadByOrderAndTerminalDeviceTypeId" parameterType="map" resultMap="OrderTerminalDeviceTypeResult">
	select t1.*,t2.ali_product_key from t_order_terminal_device_type t1 left join t_terminal_device_type t2 on t1.terminal_device_type_id = t2.id 
		where 1=1 and t1.order_id = #{orderId} and t1.terminal_device_type_id=#{terminalDeviceTypeId}
	</select>
	
	
	<select id="listByCondition" parameterType="map" resultMap="OrderTerminalDeviceTypeResult">
		select t1.*,t2.ali_product_key,t2.name as terminal_device_name from t_order_terminal_device_type t1 left join t_terminal_device_type t2 on t1.terminal_device_type_id = t2.id 
		where 1=1
		<if test="id != null ">and t1.id=#{id}</if>
		<if test="orderId != null and orderId != '' ">and t1.order_id=#{orderId}</if>
		order by t1.create_time desc
	</select>
	
	
</mapper>
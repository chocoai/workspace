<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.whty.assis.basicdata.dao.SchoolLocationAreaDao">


	<resultMap type="com.whty.assis.basicdata.model.SchoolLocationArea" id="SchoolLocationAreaResult">
		<id property="id" column="id" />
		<result property="creator" column="creator" />
		<result property="creatorName" column="creator_name" />
		<result property="createTime" column="create_time" />
		<result property="updateTime" column="update_time" />
		<result property="description" column="description" />
		<result property="schoolLocationId" column="school_location_id" />
		<result property="schoolLocationLayerId" column="school_location_layer_id" />
		<result property="attributeType" column="attribute_type" />
		<result property="number" column="number" />
		<result property="area" column="area" />
		<result property="name" column="name" />
	</resultMap>

	<resultMap type="com.whty.assis.basicdata.model.SchoolLocationLayer" id="SchoolLocationLayerResult">
		<id property="id" column="id" />
		<result property="schoolLocationId" column="school_location_id" />
		<result property="layer" column="layer" />
	</resultMap>

	<insert id="saveSchoolLocationArea" parameterType="com.whty.assis.basicdata.model.SchoolLocationArea">
		insert into
		t_school_location_area(
		school_location_id,
		creator,
		create_time,
		update_time,
		name,
		<if test="description != null and description != ''">description,</if>
		<if test="schoolLocationLayerId != null ">school_location_layer_id,</if>
		number,
		area,
		attribute_type
		) values (
		#{schoolLocationId},
		#{creator},
		#{createTime},
		#{updateTime},
		#{name},
		<if test="description != null and description != ''">#{description},</if>
		<if test="schoolLocationLayerId != null ">#{schoolLocationLayerId},</if>
		#{number},
		#{area},
		#{attributeType}
		)
	</insert>

	<select id="getAllCode" resultType="string">
		select GROUP_CONCAT(code)
		from t_school_location
	</select>


	<update id="update" parameterType="com.whty.assis.basicdata.model.SchoolLocationArea">
		update t_school_location_area
		set
		<trim prefixOverrides=",">
			<if test="updateTime != null ">, update_time=#{updateTime}</if>
			<if test="name != null and name != ''">, name=#{name}</if>
			<if test="number != null and number != ''">, number=#{number}</if>
			<if test="description != null and description != ''">, description=#{description}</if>
		</trim>
		where id=#{id}
	</update>


	<select id="loadById" parameterType="int"  resultMap="SchoolLocationAreaResult">
		select t1.*,t2.user_name as creator_name from t_school_location_area t1 left join ta_manage_user_info t2 on t1.creator=t2.id
		where 1=1 and t1.id = #{id}
	</select>

	<select id="getSchoolLocationLayer" parameterType="map" resultMap="SchoolLocationLayerResult">
		select * from t_school_location_layer where 1=1
		<if test="id != null ">and id=#{id}</if>
		<if test="schoolLocationId != null ">and school_location_id=#{schoolLocationId}</if>
		<if test="layer != null ">and layer=#{layer}</if>
	</select>

	<delete id="deleteById" parameterType="int" >
		delete from t_school_location_area where id=#{_parameter}
	</delete>

	<select id="listByCondition" parameterType="map"
		resultMap="SchoolLocationAreaResult">
		select t1.*,t2.user_name as creator_name from t_school_location_area t1 left join ta_manage_user_info t2 on t1.creator=t2.id
		where 1=1
		<if test="id != null ">and t1.id=#{id}</if>
		<if test="name != null ">and t1.name=#{name}</if>
		<if test="code != null ">and t1.code=#{code}</if>
		
		<if test="number != null and number != '' ">and t1.number like CONCAT('%',#{number},'%')</if>
		
		<if test="layer != null and schoolLocationId !=null ">
		and t1.school_location_layer_id in(select id  from t_school_location_layer where 
		school_location_id=#{schoolLocationId} and layer=#{layer})</if>
		
		<if test="schoolLocationId != null ">and t1.school_location_id=#{schoolLocationId}</if>
		<if test="schoolLocationLayerId != null ">and t1.school_location_layer_id=#{schoolLocationLayerId}</if>
		order by t1.create_time desc
	</select>


</mapper>

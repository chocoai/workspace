<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.whty.assis.basicdata.dao.DataGatherCountLogDao">

	<resultMap type="com.whty.assis.basicdata.model.DataGatherCountLog" id="DataGatherCountLogResult">
		<result column="id" property="id"/>
		<result column="software_name" property="softwareName"/>
		<result column="software_version" property="softwareVersion"/>
		<result column="corporate_name" property="corporateName"/>
		<result column="user_account" property="userAccount"/>
		<result column="user_name" property="userName"/>
		<result column="textbook_edition" property="textbookEdition"/>
		<result column="subject_id" property="subjectId"/>
		<result column="grade_id" property="gradeId"/>
		<result column="device_id" property="deviceId"/>
		<result column="create_time" property="createTime"/>
		<result column="update_time" property="updateTime"/>
		<result column="start_time" property="startTime"/>
		<result column="end_time" property="endTime"/>
		<result column="use_taking" property="useTaking"/>
		<result column="subject_name" property="subjectName"/>
		<result column="grade_name" property="gradeName"/>
		<result column="img_paths" property="imgPaths"/>
	</resultMap>
	
	<select id="listByCondition" parameterType="map" resultMap="DataGatherCountLogResult">
		select t2.name as subject_name,t3.name as grade_name,t1.*,
(select group_concat(tt2.path) from t_device_data_monitor_map tt1 left join t_device_monitor_log 
tt2 on tt1.device_monitor_log_id = tt2.id where tt1.data_gather_count_log_id=t1.id) as img_paths
 from t_data_gather_count_log t1 left join t_base_subject t2 on t1.subject_id = t2.id left join t_base_grade t3 on t1.grade_id = t3.id
 where 1=1
 <if test="deviceId != null and deviceId != '' ">and t1.device_id=#{deviceId}</if>
		order by t1.create_time desc
	</select>
	
	
</mapper>

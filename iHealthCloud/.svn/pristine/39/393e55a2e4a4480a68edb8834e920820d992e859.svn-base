<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>孝康通</title>
	<!-- Bootstrap -->
	<link th:href="@{/pages/mall/css/bootstrap.min.css}" rel="stylesheet">
	<!-- FontAwesome 4.7.0字体 -->
	<link th:href="@{/pages/mall/css/font-awesome.min.css}" rel="stylesheet">
	<!-- 自定义css -->
	<link th:href="@{/pages/mall/css/mymall.css}" rel="stylesheet">
    <!-- layer -->
    <link th:href="@{/pages/mall/css/layer_mobile/need/layer.css}" rel="stylesheet">
  </head>
  <body style="background: #f8f8f8;">
    <!-- 导航 开始 -->
    <nav class="navbar navbar-default navbar-mall-other">
      <div class="container-fluid">
        <div class="navbar-header">
          <a href="javascript:history.back();" class="othertop-left"><i class="fa fa-angle-left icon-back"></i></a>
         		 发表评价
        </div>
      </div>
    </nav>
    <!-- 订单id -->
	<input type="hidden" th:value="${order.orderId}" id="orderid">
	<input type="hidden" th:value="${type}" id="type">
	
    <!-- 导航 结束 -->
	<div th:if="${type eq 'goods'}">
	    <div class="judege-cell" th:each="orderDetail,index:${order.orderDetails}">
		      <!-- 商品id -->
			  <input type="hidden" th:value="${orderDetail.goods.goodsId}" name="cid">
		      <div class="judge-cell-hd">
		      		<img th:if="${orderDetail.goods.titleImg} ==null" src="/pages/mall/images/good01.png" class="img-responsive">
				    <img th:if="${orderDetail.goods.titleImg} !=null" th:src="${orderDetail.goods.titleImg}" class="img-responsive">
	        		<span class="judge-title">老年智能手表 实时检测心率、步数、血压、血糖</span>
	     	  </div>
	      	  <div class="judge-cell-hd score-item">
		        	<span class="makescore">给个分数吧</span>
			        <div class="star-score">
				          <ul>
				              <li class="on"></li>
				              <li class="on"></li>
				              <li class="on"></li>
				              <li class="on"></li>
				              <li class="on"></li>
				          </ul>
			        </div>
	      	  </div>
		      <div class="judge-cell-bd">
		        	<textarea class="form-control" placeholder="满足您的期待吗？说说您的感受与心得吧"></textarea>
		      </div>
	    </div>
	</div>
	<div th:if="${type eq 'service'}">
	    <div class="judege-cell">
	     	  <!-- 服务id -->
			  <input type="hidden" th:value="${order.service.serviceId}" name="cid">
		      <div class="judge-cell-hd" >
		      		<img th:if="${order.service.titleImg} ==null" src="/pages/mall/images/good01.png" class="img-responsive">
				    <img th:if="${order.service.titleImg} !=null" th:src="${orderDetail.goods.titleImg}" class="img-responsive">
	        		<span class="judge-title">老年智能手表 实时检测心率、步数、血压、血糖</span>
	     	  </div>
	      	  <div class="judge-cell-hd score-item">
		        	<span class="makescore">给个分数吧</span>
			        <div class="star-score">
				          <ul th:id ="star+${order.service.serviceId}">
				              <li class="on"></li>
				              <li class="on"></li>
				              <li class="on"></li>
				              <li class="on"></li>
				              <li class="on"></li>
				          </ul>
	      	  		</div>
	    	 </div>
	         <div class="judge-cell-bd">
	        	  <textarea class="form-control" placeholder="满足您的期待吗？说说您的感受与心得吧"></textarea>
	         </div>
	    </div>
	</div>
    
    <div class="col-xs-12 col-sm-12" style="margin-top: 10px;">
      	<a href="javascript:void(0);" id="orderComment" type="button" class="btn form-control btn-newaddress-save">发表评价</a>
    </div>

    <!-- 返回顶部 开始 -->
    <div class="gototop" style="display: none;">
      <a href="javascript:void(0)"><i class="glyphicon glyphicon-menu-up"></i></a>
    </div>
    <!-- 返回顶部 结束 -->

	<script th:src="@{/pages/mall/js/jquery-1.9.1.min.js}"></script>
	<script th:src="@{/pages/mall/js/bootstrap.min.js}"></script>
    <script th:src="@{/pages/mall/css/layer_mobile/layer.js}"></script>
    <script type="text/javascript">
	var pathName=window.document.location.pathname;
    var projectName=pathName.substring(0,pathName.substr(1).indexOf('/')+1);
      // 返回顶部
      $(window).scroll(function(){
        if($(window).scrollTop()>=20){
           $(".gototop").fadeIn(300);
        }else{
           $(".gototop").fadeOut(300);
        }
      })
      $(".gototop a").click(function(){
        $("html,body").animate({scrollTop:"0px"},300)
      })

      // 评星
      $(".star-score ul li").click(function(){
              var num = $(this).index()+1;
              var len = $(this).index();
              var thats = $(this).parent(".star-score ul").find("li");
              if($(thats).eq(len).attr("class")=="on"){
                  if($(thats).eq(num).attr("class")=="on"){
                      $(thats).removeClass();
                      for (var i=0 ; i<num; i++) {
                          $(thats).eq(i).addClass("on");
                      }
                  }
              }else{
                  $(thats).removeClass();
                  for (var j=0 ; j<num; j++) {
                      $(thats).eq(j).addClass("on");
                  }
              }
          }
      );
      var isClick = true;
      $("#orderComment").click(function(){
    	  	if(!isClick){return;}
        	var stars = [],content = [],cid = [];
	      	$(".star-score ul").each(function(i,dom){
	      		stars.push($(this).find("li.on").length);
	      	});
	      	$(".judge-cell-bd textarea").each(function(i,dom){
	      		content.push($(this).val());
	      	});
	    	$("input[name='cid']").each(function(i,dom){
		      		cid.push($(this).val());	
		    });
		    var orderid = $("#orderid").val();	  
		    var type = $("#type").val();	  

	      	var data ={
	      			orderid:orderid,
	      			cid:cid,
	      			stars:stars,
	      			content
	      	}
	      	isClick = false;
	      	$("#orderComment").text("提交中...");
	      	$.ajax({
				  url : projectName+"/h5/admin/myOrdersCom/"+type,
					data : data,
					dataType : "json",
					async : false,
					traditional : true,
					cache : true,
					success : function(data) {
						if(data.status==202){
							window.location.href=projectName+"/h5/login";
						}else if(data.status==1){
							layer.open({
								  content: '评价成功',
								  skin: 'msg',
								  time: 2 ,//2秒后自动关闭
								  end: function () {
							 			window.location.href=projectName+"/h5/admin/myOrders/"+type;
						            }
							 });
						}else{
							layer.open({
							    content: '评价失败'
							    ,skin: 'msg'
							    ,time: 2 //2秒后自动关闭
						   });
						}
					}
			  })
      })
    </script>
  </body>
</html>
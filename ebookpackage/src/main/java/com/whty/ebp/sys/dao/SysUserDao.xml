<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.whty.ebp.sys.dao.SysUserDao">

	<!-- 更新后台用户信息-->
	<update id="updateSysUser" parameterType="com.whty.ebp.sys.model.SysUser">
		update SYS_USER 
		<trim prefix="set" suffixOverrides=",">
			<if test="account != null">account=#{account},</if>
			<if test="password != null">password=#{password},</if>
			<if test="status != null">status=#{status},</if>
			<if test="update_time != null">update_time=#{update_time},</if>
			<if test="last_time != null">last_time=#{last_time},</if>
			<if test="user_name != null">user_name=#{user_name},</if>
			<if test="login_count != null">login_count=login_count+1,</if>
		</trim>
		where id=#{id}
	</update>
	
	<!-- 查询后台用户信息 -->
	<select id="loadByAccount" parameterType="string" resultType="com.whty.ebp.sys.model.SysUser">
		select id,account,password,status,create_time,update_time,
			login_count,user_name,last_time
		from SYS_USER
		where account=#{_parameter}
	</select>
	
	<!-- 查询后台用户信息 -->
	<select id="querySysUser" parameterType="map" resultType="com.whty.ebp.sys.model.SysUser">
		SELECT
		u.ID,
		u.ACCOUNT,
		u. PASSWORD,
		u. STATUS,
		u.CREATE_TIME,
		u.UPDATE_TIME,
		u.LOGIN_COUNT,
		u.USER_NAME,
		u.LAST_TIME,
		u.USER_TYPE,
		role.ROLE_NAME
		FROM
		SYS_USER_ROLE map
		LEFT OUTER JOIN SYS_USER u ON map.USER_ID = u.ID
		LEFT OUTER JOIN SYS_ROLE role ON role.ID = map.ROLE_ID
		WHERE 1 = 1 and
		u.USER_TYPE != '0'
		<if test="account != null and account != ''">and account like '%'||#{account}||'%'</if>
		<if test="status != null and status != ''">and status=#{status}</if>
		<if test="role_name != null and role_name != ''">and role_name like '%'||#{role_name}||'%'</if>
	</select>
	
	<insert id="addSysUser" parameterType="com.whty.ebp.sys.model.SysUser">
		insert into SYS_USER (
			id
			<if test="account != null">,account</if>
			<if test="password != null">,password</if>
			<if test="status != null">,status</if>
			<if test="create_time != null">,create_time</if>
			<if test="update_time != null">,update_time</if>
			<if test="last_time != null">,last_time</if>
			<if test="user_name != null">,user_name</if>
			<if test="login_count != null">,login_count</if> 
			<if test="user_type != null">,user_type</if>
		) values (
			#{id}
			<if test="account != null">,#{account}</if>
			<if test="password != null">,#{password}</if>
			<if test="status != null">,#{status}</if>
			<if test="create_time != null">,#{create_time}</if>
			<if test="update_time != null">,#{update_time}</if>
			<if test="last_time != null">,#{last_time}</if>
			<if test="user_name != null">,#{user_name}</if>
			<if test="login_count != null">,#{login_count}</if>
			<if test="user_type != null">,#{user_type}</if> 
		)
	</insert>
	
	<!-- 更新后台用户信息-->
	<update id="updateSysUserStatus" parameterType="map">
		update SYS_USER 
		set status=#{status}
		where id in <foreach collection="idList" item="id" separator="," open="(" close=")">#{id}</foreach>
	</update>
	
	<delete id="deleteSysUser" parameterType="map">
		delete from SYS_USER
		where id in <foreach collection="idList" item="id" separator="," open="(" close=")">#{id}</foreach>
	</delete>
	
</mapper>
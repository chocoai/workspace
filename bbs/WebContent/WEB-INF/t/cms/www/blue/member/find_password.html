<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>东楚论坛</title>
<link href="${base}/style/main.css" rel="stylesheet" type="text/css">
<link href="${base}/style/lanmu.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="${base}/js/jquery.js"></script>
<script type="text/javascript">
	$(document).ready(function(){
		$("#username").focus(function(){
			$("#username_message").hide();
		});
		$("#username").blur(function(){
			if($("#username").val() == ''){
				$("#username_message").html("用户名不能为空");
				$("#username_message").show();
			}
		});
		$("#email").focus(function(){
			$("#email_message").hide();
		});
		$("#email").blur(function(){
			if($("#email").val() == ''){
				$("#email_message").html("电子邮箱不能为空");
				$("#email_message").show();
			}
		});
		$("#phone").focus(function(){
			$("#phone_message").hide();
		});
		$("#phone").blur(function(){
			if($("#phone").val() == ''){
				$("#phone_message").html("电话号码不能为空");
				$("#phone_message").show();
			}
		});
		$("#captcha").focus(function(){
			$("#captcha_message").hide();
		});
	});
	
	function submitForm(){
		var sendType = $("#sendType").val();
		if(sendType != '1' && sendType != '2'){
			return ;
		}
		var username = $("#username").val();
		if(username == ''){
			$("#username_message").html("用户名不能为空");
			$("#username_message").show();
			return ;
		}
		var captcha = $("#captcha").val();
		if(captcha == ''){
			$("#captcha_message").html("验证码不能为空");
			$("#captcha_message").show();
			return ;
		}
		$.ajax({
			url:"${base}/personal/check_captcha.jspx",
			data:{"username":username,"captcha":captcha,"type":sendType},
			type:"post",
			dataType:"json",
			success:function(data){
				if(data.status == 1){
					location.href = "${base}/personal/reset_password.jspx?uuid="+data.uuid+"&resetPwd="
							+data.resetPwd+"&userId="+data.userId;
					return ;
				}else if(data.status == -1){
					alert(data.msg);
					return ;
				}else{
					
				}
			}
		});
	}
</script>
<script type="text/javascript">
	function setTab(id){
		if(id == 'one1'){
			$("#one1").addClass("off");
			$("#one2").removeClass("off");
			$("#emailDiv").show();
			$("#phoneDiv").hide();
			$("#sendType").val("1");;
		}else{
			$("#one1").removeClass("off");
			$("#one2").addClass("off");
			$("#emailDiv").hide();
			$("#phoneDiv").show();
			$("#sendType").val("2");;
		}
	}
	
	//时间函数
	var d = 60;
	var myInterval;
	function getCurDate(){
		var seconds = d--;
		if(seconds < 0){
			$("#send_message").html("");
			$("#send_captcha").removeAttr("disabled","disabled");
			d = 60;
			window.clearInterval(myInterval);
			return ;
		}
		//var ndate = years+"年"+month+"月"+days+"日 "+hours+":"+minutes+":"+seconds+" "+week;
		var ndate = "距离下次发送时间还剩&nbsp;<b>"+seconds+"</b>&nbsp;秒";
		var divT=document.getElementById("send_message");
		divT.innerHTML= ndate;
	}
	
	function sendCaptcha(){
		var sendType = $("#sendType").val();
		var username = $("#username").val();
		if(username == ''){
			$("#username_message").html("用户名不能为空");
			$("#username_message").show();
			return ;
		}
		var email = $("#email").val();
		var phone = $("#phone").val();
		if(sendType == '1' && email == ''){
			$("#email_message").html("电子邮箱不能为空");
			$("#email_message").show();
			return ;
		}
		if(sendType == '2' && phone == '')
			if(phone == ''){
			$("#phone_message").html("电话号码不能为空");
			$("#phone_message").show();
			return ;
		}else{
			return ;
		}
		$.ajax({
			url : "${base}/personal/sendCaptcha.jspx",
			data:{"username":username,"email":email,"phone":phone,"type":sendType},
			type:"post",
			dataType:"json",
			success:function(data){
				if(data.status == 1){
					$("#send_captcha").attr("disabled","disabled");
					myInterval = setInterval("getCurDate()",1000);
					alert(data.msg);
				}else if(data.status == -1){
					alert(data.msg);
				}else{
					alert("出现了未知错误");
				}
			}
		});
	}
	
</script>
</head>

<body class="body">
	<div class="register_hd_box">
		<div class="register_hd">
			<div class="register_hd_l">
				<div class="register_logo">
					<a href="${base}/"><img src="${base}/images/logo.png" alt="" /></a>
				</div>
				<div class="register_hd_fgx"></div>
				<span class="register_tit">找回密码</span>
			</div>
			<div class="register_hd_r findtop">
				<a href="${base}/login.jspx">登录</a> &nbsp;&nbsp;
				<a href="${base}/register.jspx">注册</a>
			</div>
		</div>
	</div>
	<div class="register_bg"></div>
	<div class="register_bd">
		<div class="tab_menu">
			<ul>
				<li id="one1" class="off" onclick="setTab('one1')">邮箱找回</li>
				<li id="one2" class="" onclick="setTab('one2')">手机找回</li>
			</ul>
		</div>
		<input type="hidden" id="sendType" value="1"/>
		<div class="findstep_bd">
			<form id="jvForm" action="${base}/personal/check_captcha.jspx" method="post">
				<div class="findpas_lh40">
					<span class="findpas_name">账号</span>
					<input type="text" class="findpas_adm" id="username" name="username" maxlength="100" placeholder="请您输入账号">
					[#if usernameError??]
					<span class="findpas_tips" id="username_message" style="display:block;">${usernameError!}</span>
					[#else]
					<span class="findpas_tips" id="username_message" style="display:none;"></span>
					[/#if]
				</div>
				<div class="findpas_lh40" id="emailDiv" style="display:block;">
					<span class="findpas_name">电子邮箱</span>
					<input type="email" class="findpas_adm" id="email" name="email" maxlength="100" placeholder="请您输入电子邮箱">
					[#if emailErro??]
					<span class="findpas_tips" id="email_message" style="display:block;">${emailError!}</span>
					[#else]
					<span class="findpas_tips" id="email_message" style="display:none;"></span>
					[/#if]
				</div>
				<div class="findpas_lh40" id="phoneDiv" style="display:none;">
					<span class="findpas_name">电话号码</span>
					<input type="text" class="findpas_adm" id="phone" name="phone" maxlength="11" placeholder="请您输入电话号码">
					[#if phoneError??]
					<span class="findpas_tips" id="phone_message" style="display:block;">${phoneError!}</span>
					[#else]
					<span class="findpas_tips" id="phone_message" style="display:none;"></span>
					[/#if]
				</div>
				<div class="findpas_lh40">
					<span class="findpas_name">验证码</span>
					<input type="text" class="yzm" name="captcha" id="captcha" maxlength="10" placeholder="请输入验证码">
					<input type="button" class="sendCaptcha" onclick="sendCaptcha()" id="send_captcha" value="发送验证码"/>
					<span class="findpas_captcha" id="send_message"></span>
					[#if captchaError??]
					<span class="findpas_tips" id="captcha_message" style="display:block">${captchaError!}</span>
					[#else]
					<span class="findpas_tips" id="captcha_message" style="display:none;"></span>
					[/#if]
				</div>
				<button class="findpas_nextstepbut" type="button" onclick="submitForm()">下一步</button>
			</form>
		</div>
	</div>


	<div class="reg_footerbox">
		<div class="reg_footer">
			<div class="footer">
				<div class="footer_listbox">
					<div class="footer_list">
						
					</div>
				</div>
			</div>
		</div>
	</div>

</body>

</html>

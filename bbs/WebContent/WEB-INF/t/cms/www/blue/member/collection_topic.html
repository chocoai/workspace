<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>东楚论坛</title>
<link href="${base}/style/main.css" rel="stylesheet" type="text/css">
<link href="${base}/style/lanmu.css" rel="stylesheet" type="text/css">
<link href="${base}/style/personal.css" rel="stylesheet" type="text/css">
<link href="${base}/style/page.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="${base}/js/jquery.js"></script>
<script type="text/javascript" src="${base}/js/popwin.js"></script>
<script type="text/javascript" src="${base}/js/jquery-1.11.1.min.js"></script>
<script type="text/javascript">
	$(document).ready(function() {
		var user = '${user}';
		if(user == ''){
			location.href = "${base}/login.jspx";
			return ;
		}
		$(".shezhi").click(function() {
			if ($(".setup_list").css('display') == 'none') {
				$(".setup_list").slideDown(200);
				$(".sev b").removeClass('slidedown');
				$(".sev b").addClass('slideup');
			} else {
				$(".setup_list").slideUp(200);
				$(".sev b").removeClass('slideup');
				$(".sev b").addClass('slidedown');

			}
		});
		//全选与反选
		$("#all").click(function(){
			if($("#all").prop("checked")){
				$("input[name='collectionId']").prop("checked",true);
			}else{
				$("input[name='collectionId']").prop("checked",false);
			}
		});
		$("input[type='checkbox'][name='collectionId']").click(function(){
		    if (!$("input[type='checkbox'][name='collectionId']:checked").checked) {  
		        $("#all").prop("checked", false);  
		    } 
		    var chsub = $("input[type='checkbox'][name='collectionId']").length; 
		    var checkedsub = $("input[type='checkbox'][name='collectionId']:checked").length;
		    if (checkedsub == chsub) {  
		        $("#all").prop("checked", true);  
		    }  
 		});
	});
	
	function collectionDelete(){
		var count = 0;
		var id = $("[name='collectionId']:checked");
		if(id.length == 0){
			alert("您还未选择任何选项");
			return ;
		}
		var idsStr = "";
		for(var i=0; i<id.length; i++){
			if(i == 0){
				idsStr = idsStr + id[i].value;
			}else{
				idsStr = idsStr + "," + id[i].value;
			}
		}
		$.ajax({
			url:"${base}/topic/collectionDelete.jspx",
			data:{"idsStr":idsStr},
			type:"post",
			dataType:"text",
			success:function(data){
				if(data == 1){
					alert("取消收藏成功");
					location.href = "${base}/topic/collectionTopic.jspx";
				}else{
					alert("取消收藏失败");
				}
			}
		});
	}
	
	function sign(userId){
		//alert(userId);
		if(userId == ''){
			location.href = "${base}/login.jspx";
			return ;
		}
		$.ajax({
			url:"${base}/member/point_sign.jspx",
			type:"post",
			dataType:"text",
			success:function(data){
				if(data == -1){
					alert("打卡失败");
				}else if(data == 1){
					location.reload();
				}
			}
		});
	}
</script>
</head>

<body class="body">
	<!---------顶部----------->
	<div class="p_top">
		<div class="p_top_center">
			<div class="p_top_l">
				<h1>
					<a href="${base}/"><img src="${base}/images/logo.png" alt="" /></a>
				</h1>
				<ul>
					<li class="one"><a href="/">东楚网首页</a></li>
					<li class="two"><a href="${base}/">论坛</a></li>
					<li class="thr now"><a href="${base}/member/index.jhtml">个人中心</a></li>
				</ul>
			</div>
			<div class="p_top_r">
				<span class="p_user"><a href="${base}/member/index.jhtml"><i></i>${user.username}</a></span>
				<span class="p_exit"><a
					href="${base}/logout.jspx?returnUrl=/">退出</a></span>
				<div class="here_but">
					[#if isSign?? && isSign]
					<a href="javascript:void(0);">已打卡</a>
					[#else]
					<a href="javascript:void(0);" onclick="sign('${user.id}')">每日打卡</a>
					[/#if]
				</div>
			</div>
		</div>
	</div>

	<!-------用户信息-------->
	<div class="inf_box">
		<div class="inf">
			<div class="inf_l">
				<a href="${base}/member/information.jhtml">
					[#if user.avatar??]
					<img src="${user.avatar}" alt="" />
					[#else]
					<img src="${base}/images/default_user.jpg" alt="" />
					[/#if]
				</a>
			</div>
			<div class="inf_r">
				<p class="inf_user_name">
					<a href="${base}/member/information.jhtml">${user.username}</a>
				</p>
				<p class="inf_user_d">
					<span class="inf_tz"><a href="${base}/member/mytopic.jhtml">帖子：<b>${user.topicCount}</b></a></span>
					<span class="inf_tb"><a href="${base}/member/creditManager.jhtml"><i></i>铜币：<b>${user.point}</b></a></span>
					<span class="inf_dj"><a href="${base}/member/level_list.jspx"><i></i>等级：<b>${user.group.name}</b></a></span>
				</p>
			</div>
		</div>
	</div>


	<!------------------中间内容部分------------------------>
	<div class="center">
		<div class="content">
			<!------菜单------->
			<div class="menu">
				<ul class="menu_list">
					<li class="now"><a href="${base}/topic/collectionTopic.jspx" class="fir"><i></i>我的收藏</a></li>
					<li><a href="${base}/member/album.jspx" class="sec"><i></i>我的相册</a></li>
					<li><a href="${base}/member/mytopic.jhtml" class="thi"><i></i>我的帖子</a></li>
					<li><a href="${base}/member/myfriend.jhtml" class="fou"><i></i>我的好友</a></li>
					<li><a href="${base}/member/personal_message.jspx" class="fif"><i></i>我的消息</a></li>
					<li><a href="${base}/member/concern_list.jspx" class="six"><i></i>我的关注</a></li>
					<li><a href="${base}/member/creditManager.jhtml" class="sev"><i></i>我的铜币</a></li>
					<li><a href="${base}/member/task_list.jspx" class="eig"><i></i>我的任务</a></li>
					<li class="shezhi"><a class="nin"><i></i>设置<b class="slidedown"></b></a></li>
					<ul class="setup_list" style="display: none;">
						<li><a href="${base}/member/information.jhtml" class="ten"><i></i>账号</a></li>
						<li><a href="${base}/member/personal_confirm.jspx" class="ele"><i></i>认证</a></li>
						<li><a href="${base}/member/level_list.jspx" class="twe"><i></i>等级</a></li>
						<li><a href="${base}/member/personal_binding.jspx" class="thir"><i></i>账号通</a></li>
					</ul>
				</ul>
			</div>


			<!--------右侧内容部分——我收藏的帖子--------->
			<div class="content_r">
				<div class="content_r_hd">我的收藏</div>
				<div class="xxk">
					<span class="now"><a href="${base}/topic/collectionTopic.jspx">我收藏的帖子</a></span>
					<span><a href="${base}/topic/collectionForum.jspx">我收藏的栏目</a></span>
				</div>
				<div class="shoucang">
					<div class="shoucang_hd">
						<div class="shoucang_hd_title">话题</div>
						<div class="shoucang_hd_write">作者</div>
						<div class="shoucang_hd_count">回复/点击</div>
						<div class="shoucang_hd_from">所在栏目</div>
					</div>
					[#if pageBean.list?size gt 0]
						<ul class="tie_list">
							[#list pageBean.list as collection]
							<li>
								<input type="checkbox" name="collectionId" value="${collection.id}">
								<p class="tie_title">
									<a href="${collection.topic.url}">${collection.topic.title}</a>
								</p>
								<p class="tie_write">
									<a href="personal_other_information.html">${collection.creater.username}</a>
									<span class="date">${collection.createTime?string("yyyy-MM-dd")}</span>
								</p>
								<p class="tie_count">${collection.topic.replyCount}/${collection.topic.viewCount}</p>
								<p class="tie_from">
									<a href="lanmu6.html">${collection.topic.forum.title}</a>
								</p>
							</li>
							[/#list]
						</ul>
						<div class="selectall">
							<input type="checkbox" id="all">
							<b>全选</b> | 
							<span class="cancel_but">&nbsp;&nbsp;
								<a href="javascript:void(0);" onclick="collectionDelete()">取消收藏</a>
							</span>
						</div>
						<!--分页--->
						<div class="page_box">
							<div style="clear: left;">
								[#import "/WEB-INF/t/cms/www/blue/tld/page.ftl" as tt]
								[@tt.page pageBean=pageBean url="${base}/topic/collectionTopic.jspx" /]
							</div>
						</div>
					[#else]
					<div style="clear: left;height:8px;"></div>
					<p style="height:20px;text-align:center;">您暂时没有收藏任何帖子</p>
					[/#if]
				</div>
			</div>


			<!------页脚------>
			<div class="footer">
				<div class="footer_listbox">
					<div class="footer_list">
						
					</div>
				</div>
			</div>

		</div>


		<!------------------返回顶部-------------------->
		<div id="before">
			<a href="http://bbs.hsdcw.com/" target="_blank" title="东楚论坛"
				class='before'></a>
		</div>
		<div id="wechat" class="wechat">
			<a href="javascript:void(0)"><div class="wechath"></div></a>
		</div>
		<a id="moquu_top" href="javascript:void(0)"></a>
</body>
</html>

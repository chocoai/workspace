<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>东楚论坛</title>
<link href="${base}/style/main.css" rel="stylesheet" type="text/css">
<link href="${base}/style/lanmu.css" rel="stylesheet" type="text/css">
<link href="${base}/style/personal.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="${base}/js/jquery.js"></script>
<script type="text/javascript" src="${base}/js/popwin.js"></script>
<script type="text/javascript" src="${base}/js/jquery-1.11.1.min.js"></script>
<script type="text/javascript">
	$(document).ready(function() {
		$(".shezhi").click(function() {
			if ($(".setup_list").css('display') == 'none') {
				$(".setup_list").slideDown(200);
				$(".sev b").removeClass('slidedown');
				$(".sev b").addClass('slideup');
			} else {
				$(".setup_list").slideUp(200);
				$(".sev b").removeClass('slideup');
				$(".sev b").addClass('slidedown');

			}
		});
		$("#phone").focus(function(){
			$("#phone_success").hide();
			$("#phone_error").hide();
		});
		$("#phone").blur(function(){
			checkPhone();
		});
		$("#captcha").focus(function(){
			$("#captcha_error").hide();
		});
		$("#captchaOld").focus(function(){
			$("#captcha_error_old").hide();
		});
	});
	
	function sign(userId){
		if(userId == ''){
			location.href = "${base}/login.jspx";
			return ;
		}
		$.ajax({
			url:"${base}/member/point_sign.jspx",
			type:"post",
			dataType:"text",
			success:function(data){
				if(data == -1){
					alert("打卡失败");
				}else if(data == 1){
					location.reload();
				}
			}
		});
	}
	
	function checkPhone(){
		var phone = $("#phone").val();
		if(phone==''){
			$("#phone_error").html('<i class="icon_no"></i>手机号码不能为空');
			$("#phone_error").show();
			return false;
		}
		var mobileRegexp = /^((\+86)|(86))|(((13[0-9]{1})|(14[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
		if (!mobileRegexp.test(phone)) {
			$("#phone_error").html('<i class="icon_no"></i>手机号码格式错误');
			$("#phone_error").show();
			return false;
		}
		$("#phone_success").hide();
		$("#phone_error").hide();
		return true;
	}
	
	function sendCaptcha(){
		var phone = $("#phone").val();
		if(!checkPhone()){
			return ;
		}
		$.ajax({
			url:"${base}/personal/send_phone_captcha.jspx",
			data:{"phone":phone},
			type:"post",
			dataType:"json",
			success:function(data){
				if(data.status == 1){
					alert(data.msg);
				}else if(data.status == -2){
					alert(data.msg);
				}else if(data.status == -1){
					loaction.href = "${base}/login.jspx";
				}
			}
		});
	}
	function sendCaptcha1(){
		var phone = $("#phoneOld").val();
		$.ajax({
			url:"${base}/personal/send_phone_captcha.jspx",
			data:{"phone":phone},
			type:"post",
			dataType:"json",
			success:function(data){
				if(data.status == 1){
					alert(data.msg);
				}else if(data.status == -2){
					alert(data.msg);
				}else if(data.status == -1){
					loaction.href = "${base}/login.jspx";
				}
			}
		});
	}
	
	function binding(){
		var captcha = $("#captcha").val();
		if(captcha == ''){
			$("#captcha_error").html('验证码不能为空');
			$("#captcha_error").show();
			return ;
		}
		$.ajax({
			url:"${base}/personal/binding_phone.jspx",
			data:{"captcha":captcha},
			type:"post",
			dataType:"json",
			success:function(data){
				if(data.status == -1){
					loaction.href = "${base}/login.jspx";
				}else if(data.status == -2){
					alert(data.msg);
				}else if(data.status == 1){
					alert("绑定成功");
					location.reload();
				}else{
					alert("绑定失败");
				}
			}
		});
	}
	
	function showBindBox(){
		$("#checkOld").toggle();
	}
	function checkOld(){
		var captcha = $("#captchaOld").val();
		if(captcha == ''){
			$("#captcha_error_old").html('验证码不能为空');
			$("#captcha_error_old").show();
			return ;
		}
		$.ajax({
			url:"${base}/personal/checkOld.jspx",
			data:{"captcha":captcha},
			type:"post",
			dataType:"json",
			success:function(data){
				if(data.status == -1){
					loaction.href = "${base}/login.jspx";
				}else if(data.status == -2){
					alert(data.msg);
				}else if(data.status == 1){
					$("#checkOld").hide();
					$("#checkNew").show();
				}else{
					alert("验证失败");
				}
			}
		});
	}
</script>

</head>

<body class="body">
	<!---------顶部----------->
	<div class="p_top">
		<div class="p_top_center">
			<div class="p_top_l">
				<h1>
					<a href="${base}/"><img src="${base}/images/logo.png" alt="" /></a>
				</h1>
				<ul>
					<li class="one"><a href="/">东楚网首页</a></li>
					<li class="two"><a href="${base}/">论坛</a></li>
					<li class="thr now"><a href="${base}/member/index.jhtml">个人中心</a></li>
				</ul>
			</div>
			<div class="p_top_r">
				<span class="p_user"><a href="${base}/member/index.jhtml"><i></i>${user.username}</a></span>
				<span class="p_exit"><a
					href="${base}/logout.jspx?returnUrl=/">退出</a></span>
				<div class="here_but">
					[#if isSign?? && isSign]
					<a href="javascript:void(0);">已打卡</a>
					[#else]
					<a href="javascript:void(0);" onclick="sign('${user.id}')">每日打卡</a>
					[/#if]
				</div>
			</div>
		</div>
	</div>

	<!-------用户信息-------->
	<div class="inf_box">
		<div class="inf">
			<div class="inf_l">
				<a href="${base}/member/information.jhtml">
					[#if user.avatar??]
					<img src="${user.avatar}" alt="" />
					[#else]
					<img src="${base}/images/default_user.jpg" alt="" />
					[/#if]
				</a>
			</div>
			<div class="inf_r">
				<p class="inf_user_name">
					<a href="${base}/member/information.jhtml">${user.username}</a>
				</p>
				<p class="inf_user_d">
					<span class="inf_tz"><a href="${base}/member/mytopic.jhtml">帖子：<b>${user.topicCount}</b></a></span>
					<span class="inf_tb"><a href="${base}/member/creditManager.jhtml"><i></i>铜币：<b>${user.point}</b></a></span>
					<span class="inf_dj"><a href="${base}/member/level_list.jspx"><i></i>等级：<b>${user.group.name}</b></a></span>
				</p>
			</div>
		</div>
	</div>


	<!------------------中间内容部分------------------------>
	<div class="center">
		<div class="content">
			<!------菜单------->
			<div class="menu">
				<ul class="menu_list">
					<li><a href="${base}/topic/collectionTopic.jspx" class="fir"><i></i>我的收藏</a></li>
					<li><a href="${base}/member/album.jspx" class="sec"><i></i>我的相册</a></li>
					<li><a href="${base}/member/mytopic.jhtml" class="thi"><i></i>我的帖子</a></li>
					<li><a href="${base}/member/myfriend.jhtml" class="fou"><i></i>我的好友</a></li>
					<li><a href="${base}/member/personal_message.jspx" class="fif"><i></i>我的消息</a></li>
					<li><a href="${base}/member/concern_list.jspx" class="six"><i></i>我的关注</a></li>
					<li><a href="${base}/member/creditManager.jhtml" class="sev"><i></i>我的铜币</a></li>
					<li><a href="${base}/member/task_list.jspx" class="eig"><i></i>我的任务</a></li>
					<li class="shezhi"><a class="nin"><i></i>设置<b class="slidedown"></b></a></li>
					<ul class="setup_list" style="display: none;">
						<li><a href="${base}/member/information.jhtml" class="ten"><i></i>账号</a></li>
						<li class="now"><a href="${base}/member/personal_confirm.jspx" class="ele"><i></i>认证</a></li>
						<li><a href="${base}/member/level_list.jspx" class="twe"><i></i>等级</a></li>
						<li><a href="${base}/member/personal_binding.jspx" class="thir"><i></i>账号通</a></li>
					</ul>
				</ul>
			</div>

			<!--------右侧内容部分——认证--------->
			<div class="content_r" id="content_r">
				<div class="content_r_hd">绑定手机</div>
				<div class="step">
					<!-- <div class="step_hd">
						<ul>
							<li class="firststep"><i>1</i>输入手机号码</li>
							<li class="secondstep"><i>2</i>输入验证码</li>
							<li class="thirdstep"><i>3</i>手机绑定成功</li>
						</ul>
					</div> -->
					[#if user.userExtSet[0].moble??]
					<div class="sucbli">
		        		<p class="sucbli_pra01">
		           		<i><img src="${base}/images/icon_yes.png" style="margin-top:5px;"/></i>恭喜您，<span class="myname">${user.username!}</span>，您已经与您的手机号 <span class="myphone">${user.userExtSet[0].moble!}</span> 成功绑定！&nbsp;&nbsp;&nbsp;<input type="button" style=" margin-left:10px; width:88px; text-align:center; background:#f5f5f5; border:1px solid #ddd;border-radius:4px;cursor:pointer;" onclick="showBindBox()" value="更换手机绑定"/></p>
		       		</div>
		       		<div class="step_con" id="checkOld" style="display:none;">
						<div class="h28">
							<span class="step_con_l">原手机号码：</span>
							<input class="step_con_c" id="phoneOld" maxlength="11" type="text" readonly value="${user.userExtSet[0].moble!}">
						</div>
						<div class="h28 marbot">
			              	<span class="step_con_l">输入验证码：</span>
			              	<input class="step_yzm" id="captchaOld" type="text">
			              	<input type="button" class="step_sendyzm" onclick="sendCaptcha1()" value="发送验证码"/>
			              	<div class="step_tips sucsend" id="captcha_error_old" style="color:#e80701;display:none;">验证码已发送</div>
			          	</div>
			           	<div class="h30" style="margin-top:10px;"><input type="button" class="acceptbli" value="下一步" onclick="checkOld()"/></div>
					</div>
		       		<div class="step_con" id="checkNew" style="display:none;">
						<div class="h28">
							<span class="step_con_l">输入手机号码：</span>
							<input class="step_con_c" id="phone" maxlength="11" type="text">
							<div class="step_tips">
								<span class="step_yes" style="display: none;" id="phone_success"><i class="icon_yes"></i>正确</span>
								<span class="step_no" style="display: none;" id="phone_error"><i class="icon_no"></i>手机号码格式错误</span>
							</div>
						</div>
						<div class="h28 marbot">
			              	<span class="step_con_l">输入验证码：</span>
			              	<input class="step_yzm" id="captcha" type="text">
			              	<input type="button" class="step_sendyzm" onclick="sendCaptcha()" value="发送验证码"/>
			              	<div class="step_tips sucsend" id="captcha_error" style="color:#e80701;display:none;">验证码已发送</div>
			          	</div>
			           	<div class="h30" style="margin-top:10px;"><input type="button" class="acceptbli" value="确定绑定" onclick="binding()"/></div>
					</div>
		       		[#else]
					<div class="step_con">
						<div class="h28">
							<span class="step_con_l">输入手机号码：</span>
							<input class="step_con_c" id="phone" maxlength="11" type="text">
							<div class="step_tips">
								<span class="step_yes" style="display: none;" id="phone_success"><i class="icon_yes"></i>正确</span>
								<span class="step_no" style="display: none;" id="phone_error"><i class="icon_no"></i>手机号码格式错误</span>
							</div>
						</div>
						<div class="h28 marbot">
			              	<span class="step_con_l">输入验证码：</span>
			              	<input class="step_yzm" id="captcha" type="text">
			              	<input type="button" class="step_sendyzm" onclick="sendCaptcha()" value="发送验证码"/>
			              	<div class="step_tips sucsend" id="captcha_error" style="color:#e80701;display:none;">验证码已发送</div>
			          	</div>
			           	<div class="h30" style="margin-top:10px;"><input type="button" class="acceptbli" value="确定绑定" onclick="binding()"/></div>
					</div>
		       		[/#if]
				</div>

			</div>


			<!------页脚------>
			<div class="footer">
				<div class="footer_listbox">
					<div class="footer_list">
						
					</div>
				</div>
			</div>

		</div>


		<!------------------返回顶部-------------------->
		<div id="before">
			<a href="http://bbs.hsdcw.com/" target="_blank" title="东楚论坛"
				class='before'></a>
		</div>
		<div id="wechat" class="wechat">
			<a href="javascript:void(0)"><div class="wechath"></div></a>
		</div>
		<a id="moquu_top" href="javascript:void(0)"></a>
</body>
</html>
